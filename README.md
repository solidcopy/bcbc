# これは何？

## 概要

* 何テラバイトもある大容量のデータ、たとえば動画など、を持っている。
* 1台のHDDには収まらないので多数のHDDに分散して保存している。
* HDDの故障に備えてそれぞれのデータは2部以上のコピーを保持したい。

という状況で、 **バックアップが正しく行えているか確認する** ためのツール。

## より具体的な利用シナリオ

次のような状況であるとする。

HDDの空き容量が足りなくなる度にコスパのいい製品を買い足しているので、持っているHDDの容量はバラバラである。

大量データを2部ずつコピーして保存しておきたい。

HDDをAグループとBグループに分けて、各グループに1部ずつ保存する。

コピーは手作業で行っているため手違いで正しくバックアップできていない可能性がある。

たとえばあるファイルが、

* 1部しかコピーされていない
* Aグループにだけ2部あってBグループにない
* 必要以上にコピーを作ってしまっている
* 同じファイルのはずが内容に差違が生じている

ということがあり得る。

このような不備がないか目視で確認するのは容易ではない。

`bcbc` を利用すると各グループのHDD群に同じファイルが同じ内容でコピーされているかを確認できる。

# インストール & 設定

## バイナリのダウンロード

GitHubのReleasesからダウンロードするか、以下でビルドする。

```
$ cargo build --release
```

バイナリは任意のディレクトリに配置して `PATH` を通す。

## 環境変数

環境変数BCBCHOMEに任意のディレクトリへのフルパスを設定する。

バイナリを配置したディレクトリでもそうでなくてもよい。

## 設定ファイルの作成

設定ファイル `${BCBCHOME}/configs/filter.conf` が必要なので用意する。

[サンプルファイル](https://github.com/solidcopy/bcbc/blob/master/configs/filter.conf.sample)をコピーしてファイル中のコメントを参考に編集する。

このファイルで設定したフィルターによってチェック対象のディレクトリ/ファイルが決まる。

## diskファイルの作成

データを保存するHDDをグループに分割する。

各ファイルを2部ずつコピーするならAグループとBグループ、3部ならCグループを追加する。

HDDのルートディレクトリに `disk` （拡張子なし）という名前でファイルを作成する。

このファイルにはグループ名と、グループ内での連番だけを書く。

Aグループの3番目のHDDである場合の例）

```
A3
```

# 実行

`bcbc` コマンドにHDDのルートディレクトリのフルパスを指定する。（複数指定可能）

Windowsの例）

```
C:\xxx> bcbc D:\ E:\ F:\
```

UNIX系の例）

```
$ bcbc /mnt/HDD_1 /mnt/HDD_2
```

初回の実行では全ファイルをチェックする。<br>
2回目以降では未チェックのファイルのみ対象にする。

# 結果の確認

実行が完了すると `#{BCBCHOME}/out/` にファイルパスとそのファイルから計算したハッシュの一覧を出力する。

* A1
* A2
* B1
* B2

といったファイル名でHDDごとの一覧、

* A
* B

というファイル名でグループごとの一覧を統合したものを出力する。

テキストファイルを比較するコマンドやツールでグループごとのファイルが同じであるか判定し、
そうであれば両グループに同じファイルがバックアップされていることが分かる。
